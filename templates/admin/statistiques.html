{% extends "admin/layout.html" %}
{% block title %}Statistiques / Export - Student Grades App{% endblock %}

{% block admin_content %}
<h3 class="mb-4">Statistiques / Export</h3>
<div class="mb-3">
  <a href="{{ url_for('admin_export_csv') }}" class="btn btn-success btn-sm">Exporter CSV</a>
</div>
<div class="row g-3 mb-4">
  <div class="col-12">
    <div class="card shadow-sm">
      <div class="card-header bg-white"><strong>Moyenne générale</strong></div>
      <div class="card-body">
        <p class="mb-0 fs-4">{{ moyenne_generale|default('-', true) }}</p>
      </div>
    </div>
  </div>
  <div class="col-lg-6">
    <div class="card shadow-sm">
      <div class="card-header bg-white"><strong>Moyenne par étudiant</strong></div>
      <div class="card-body p-0">
        <table class="table table-striped mb-0">
          <thead class="table-light">
            <tr><th>Étudiant</th><th>Moyenne</th></tr>
          </thead>
          <tbody>
            {% for row in moyenne_par_etudiant %}
            <tr><td>{{ row[0] }}</td><td>{{ '%.2f'|format(row[1]) if row[1] is not none else '-' }}</td></tr>
            {% else %}
            <tr><td colspan="2" class="text-muted">Aucune donnée.</td></tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
  <div class="col-lg-6">
    <div class="card shadow-sm">
      <div class="card-header bg-white"><strong>Statut des matières</strong></div>
      <div class="card-body p-0">
        <table class="table table-striped mb-0">
          <thead class="table-light">
            <tr><th>Matière</th><th>Moyenne</th><th>Statut</th></tr>
          </thead>
          <tbody>
            {% for s in stats_matieres %}
            <tr>
              <td>{{ s.nom }}</td>
              <td>{{ s.moyenne|default('-', true) }}</td>
              <td>
                {% if s.statut == 'Validée' %}<span class="badge bg-success">Validée</span>
                {% elif s.statut == 'À rattraper' %}<span class="badge bg-warning text-dark">À rattraper</span>
                {% elif s.statut == 'Non validée' %}<span class="badge bg-danger">Non validée</span>
                {% else %}<span class="badge bg-secondary">{{ s.statut }}</span>{% endif %}
              </td>
            </tr>
            {% else %}
            <tr><td colspan="3" class="text-muted">Aucune matière.</td></tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
{% endblock %}
